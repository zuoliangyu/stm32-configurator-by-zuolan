<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'none'; style-src {{cspSource}} 'unsafe-inline'; script-src {{cspSource}};">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{cssUri}}" rel="stylesheet">
    <title>STM32 Debug Configurator</title>
</head>

<body>
    <div class="container">
        <!-- Language Switch -->
        <div class="language-switch">
            <label for="language-select" data-i18n="language">Language</label>
            <select id="language-select">
                <option value="en">English</option>
                <option value="zh">中文</option>
            </select>
        </div>
        
        <h1 data-i18n="title">STM32 Debug Configuration</h1>
        <p data-i18n="subtitle">Fill in the details below to generate a `launch.json` configuration for Cortex-Debug.</p>

        <div class="form-group">
            <label data-i18n="elfSource">Executable (.elf) Path Source</label>
            <div class="radio-group">
                <label><input type="radio" name="elfSource" value="auto" checked> <span data-i18n="autoDetectElf">Auto-detect (Requires ST's STM32 Extension)</span></label>
                <label><input type="radio" name="elfSource" value="manual"> <span data-i18n="manualElf">Manual Path</span></label>
            </div>
        </div>

        <div class="form-group hidden" id="manual-elf-path-group">
            <label for="executablePath" data-i18n="manualElfPath">Manual .elf Path</label>
            <input type="text" id="executablePath" placeholder="e.g., ${workspaceFolder}/build/project.elf">
        </div>
        <div class="form-group">
            <label for="deviceName" data-i18n="deviceName">Device Name (e.g., STM32F407ZG)</label>
            <input type="text" id="deviceName" value="STM32F407ZG" data-i18n-placeholder="devicePlaceholder">
        </div>

        <div class="form-group">
            <label for="servertype" data-i18n="gdbServer">GDB Server</label>
            <select id="servertype">
                <option value="openocd" selected>OpenOCD</option>
                <option value="pyocd">pyOCD</option>
                <option value="jlink">J-Link</option>
                <option value="stlink">ST-Link GDB Server</option>
                <option value="stutil">ST-Util</option>
            </select>
        </div>

        <div id="openocd-options">
            <div class="form-group" id="openocd-path-group">
                <label for="openocdPath" data-i18n="openocdPath">OpenOCD Path (Optional)</label>
                <div class="input-group">
                    <input type="text" id="openocdPath" data-i18n-placeholder="autoDetecting">
                    <button id="browse-button" data-i18n="browseButton" title="Browse for OpenOCD executable">Browse</button>
                    <button id="refresh-button" data-i18n="scanButton" title="Re-scan for OpenOCD in system PATH">Scan</button>
                    <button id="env-setup-button" data-i18n="envSetupButton" title="Environment variable setup guide">ENV Setup</button>
                </div>
                <div id="openocd-status" class="status-info">
                    <!-- OpenOCD status will be dynamically updated here -->
                </div>
                <div id="download-link-container" class="hidden">
                    <small><span data-i18n="noOpenocdFound">OpenOCD not found.</span> 
                    <a href="#" id="env-guide-link" data-i18n="viewEnvGuide">View environment setup guide</a> | 
                    <a href="https://github.com/xpack-dev-tools/openocd-xpack/releases" data-i18n="downloadOpenocd">Download OpenOCD</a></small>
                </div>
            </div>

            <div class="form-group">
                <label for="interfaceFile" data-i18n="interfaceFile">Interface File</label>
                <div class="searchable-select">
                    <div class="search-input-wrapper">
                        <input type="text" id="interfaceFileSearch" class="search-input" data-i18n-placeholder="searchInterface" placeholder="Search interface files...">
                        <button type="button" class="search-clear-btn" id="interfaceFileSearchClear" title="Clear search">×</button>
                    </div>
                    <select id="interfaceFile" class="searchable-dropdown">
                        <option value="" disabled selected data-i18n="providePath">Provide valid OpenOCD path to populate...</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="adapterSpeed" data-i18n="adapterSpeed">Adapter Speed (kHz)</label>
                <input type="number" id="adapterSpeed" value="4000" placeholder="e.g., 4000">
            </div>
        </div>

        <!-- ARM Toolchain Configuration Section -->
        <div class="form-group" id="arm-toolchain-section">
            <label for="armToolchainPath" data-i18n="armToolchainPath">ARM Toolchain Path (Optional)</label>
            <div class="input-group">
                <input type="text" id="armToolchainPath" data-i18n-placeholder="autoDetecting">
                <button id="browse-arm-button" data-i18n="browseButton" title="Browse for ARM toolchain executable">Browse</button>
                <button id="refresh-arm-button" data-i18n="scanButton" title="Re-scan for ARM toolchain in system PATH">Scan</button>
            </div>
            <div id="arm-download-link-container" class="hidden">
                <small><span data-i18n="noArmToolchainFound">ARM Toolchain not found.</span> <a href="https://developer.arm.com/downloads/-/arm-gnu-toolchain-downloads" data-i18n="downloadArmToolchain">Download it here</a>.</small>
            </div>
            <div id="arm-toolchain-info" class="toolchain-info hidden">
                <div class="info-row">
                    <span class="info-label" data-i18n="version">Version:</span>
                    <span id="arm-version" class="info-value">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label" data-i18n="target">Target:</span>
                    <span id="arm-target" class="info-value">-</span>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="targetFile" data-i18n="targetFile">Target File / ID</label>
            <div class="searchable-select">
                <div class="search-input-wrapper">
                    <input type="text" id="targetFileSearch" class="search-input" data-i18n-placeholder="searchTarget" placeholder="Search target files...">
                    <button type="button" class="search-clear-btn" id="targetFileSearchClear" title="Clear search">×</button>
                </div>
                <select id="targetFile" class="searchable-dropdown">
                    <option value="" disabled selected>Provide valid OpenOCD path to populate...</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label for="svdFilePath" data-i18n="svdFile">SVD File Path (Optional)</label>
            <input type="text" id="svdFilePath" data-i18n-placeholder="svdPlaceholder">
        </div>

        <div class="form-group">
            <label>
                <input type="checkbox" id="liveWatchEnabled"> <span data-i18n="liveWatchEnable">Enable Live Watch</span>
            </label>
        </div>

        <div class="form-group hidden" id="livewatch-options">
            <!-- Dynamic Variable Management -->
            <div class="form-group">
                <label data-i18n="currentVariables">Current Variables</label>
                <div id="variable-list" class="variable-list"></div>
                <div class="variable-add-section">
                    <div class="input-group">
                        <input type="text" id="newVariableInput" data-i18n-placeholder="variableName" placeholder="Variable name">
                        <button type="button" id="addVariableButton" data-i18n="addVariable">Add Variable</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="liveWatchFrequency" data-i18n="liveWatchFrequency">Update Frequency (samples/second)</label>
                <input type="number" id="liveWatchFrequency" value="4" min="1" max="100" placeholder="e.g., 4">
                <small data-i18n="liveWatchFrequencyHelp">Higher values provide more frequent updates but may impact debugging performance</small>
            </div>
        </div>

        <button id="generate-button" data-i18n="generateButton">Generate Configuration</button>
        <p class="footer" data-i18n="createdBy">Created by 左岚</p>
    </div>

    <script src="{{stateManagerUri}}"></script>
    <script src="{{jsUri}}"></script>
</body>

</html>