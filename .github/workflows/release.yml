# 工作流的名称
name: Create Release and Upload VSIX

# 工作流的触发条件
on:
  push:
    tags:
      - 'v*.*.*'

# 工作流包含的任务
jobs:
  build-and-release:
    # 任务运行的环境
    runs-on: ubuntu-latest

    # --- 修正点：为这个任务添加权限 ---
    permissions:
      contents: write

    # 任务的步骤
    steps:
      # 第一步：检出你的代码
      - name: Checkout code
        uses: actions/checkout@v4

      # 第二步：设置 Node.js 环境
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 第三步：安装项目依赖和 vsce 工具
      - name: Install dependencies and vsce
        run: |
          npm install
          npm install -g @vscode/vsce

      # 第四步：打包插件
      - name: Package extension
        run: vsce package --allow-missing-repository

      # 第五步：创建 GitHub Release 并上传 .vsix 文件
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: '*.vsix'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}